title: moz-os — phase_0006: protected mode entry + segment initialization  

intent  
introduce deterministic transition from real mode into 32‑bit protected mode. this phase ensures the cpu executes with flat segmentation using the gdt defined earlier. the loader will set cr0, perform a far jump into protected mode, reload segment registers, and print a confirmation banner. no paging yet. no long mode. no kernel load. no mining logic.  

this phase adds:  
- protected mode enable routine (cr0 pe bit)  
- far jump into code segment  
- segment register reload (ds, es, ss)  
- confirmation banner after protected mode entry  

no paging.  
no long mode.  
no kernel.  
no hashing.  

============================================================  
section 1 — workspace structure extension  
============================================================  

1. modify boot/stage2.asm to include protected mode entry routine.  
2. keep boot/mbr.asm unchanged.  
3. keep kernel/ untouched.  

============================================================  
section 2 — implement protected mode entry  
============================================================  

1. in boot/stage2.asm:  
   - set pe bit in cr0.  
   - perform far jump to code segment selector (0x08).  
   - reload ds, es, ss with data segment selector (0x10).  
   - print banner (“stage2: entered protected mode”).  

2. halt in place after printing.  

============================================================  
section 3 — deterministic boot behavior  
============================================================  

1. bios loads mbr at 0x7c00.  
2. mbr prints banner, reads stage‑2 from lba 2 into 0x8000.  
3. mbr jumps to 0x8000.  
4. stage‑2 enables a20, loads gdt, sets cr0 pe bit, far jumps, reloads segments, prints confirmation banner, halts deterministically.  

============================================================  
section 4 — no other files modified  
============================================================  

- do not add paging structures.  
- do not add long mode code.  
- do not add kernel code.  
- only modify stage‑2 to enter protected mode.  

============================================================  
completion criteria  
============================================================  

- boot/stage2.asm assembles to boot/stage2.bin without errors.  
- boot/mbr.asm assembles to boot/mbr.bin without errors.  
- boot image runs in qemu:  
  - prints “mbr: moz-os boot entry”  
  - prints “stage2: a20 line enabled”  
  - prints “stage2: gdt loaded”  
  - prints “stage2: entered protected mode”  
  - halts deterministically.  
- all lint warnings and errors resolved.  

============================================================  
post completion chores  
============================================================  

1. rename the current phase file by adding a .complete to the end of the name. for example: phase_0006.txt would become phase_0006.txt.complete  
2. add all files and commit them to git using the following format for the comment.  
    - feat: phase 0006: protected mode entry + segment initialization  
3. determine the next phase sequentially and execute it: phase_0007.txt  