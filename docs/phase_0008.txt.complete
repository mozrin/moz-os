title: moz-os — phase_0008: long mode transition + 64‑bit entry  

intent  
introduce deterministic transition from 32‑bit protected mode into 64‑bit long mode. this phase enables pae, sets efer.lme, activates paging, and performs a far jump into 64‑bit code. the loader will confirm entry into long mode with a banner. no kernel load yet. no mining logic.  

this phase adds:  
- pae enable (cr4)  
- efer msr modification (set lme bit)  
- paging enable (cr0 pg bit)  
- far jump into 64‑bit code segment  
- confirmation banner after long mode entry  

no kernel.  
no hashing.  

============================================================  
section 1 — workspace structure extension  
============================================================  

1. modify boot/stage2.asm to include long mode transition routine.  
2. keep boot/mbr.asm unchanged.  
3. keep kernel/ untouched.  

============================================================  
section 2 — implement long mode transition  
============================================================  

1. in boot/stage2.asm:  
   - set pae bit in cr4.  
   - load cr3 with pml4 base (already built in phase_0007).  
   - read efer msr (0xc0000080), set lme bit, write back.  
   - set pg bit in cr0 to enable paging.  
   - perform far jump to 64‑bit code segment selector (0x08).  
   - in 64‑bit mode, print banner (“stage2: entered long mode”).  

2. halt in place after printing.  

============================================================  
section 3 — deterministic boot behavior  
============================================================  

1. bios loads mbr at 0x7c00.  
2. mbr prints banner, reads stage‑2 from lba 2 into 0x8000.  
3. mbr jumps to 0x8000.  
4. stage‑2 enables a20, loads gdt, enters protected mode, builds paging structures, sets pae, sets efer.lme, enables paging, far jumps, prints confirmation banner, halts deterministically.  

============================================================  
section 4 — no other files modified  
============================================================  

- do not add kernel code.  
- only modify stage‑2 to enter long mode.  

============================================================  
completion criteria  
============================================================  

- boot/stage2.asm assembles to boot/stage2.bin without errors.  
- boot/mbr.asm assembles to boot/mbr.bin without errors.  
- boot image runs in qemu:  
  - prints “mbr: moz-os boot entry”  
  - prints “stage2: a20 line enabled”  
  - prints “stage2: gdt loaded”  
  - prints “stage2: entered protected mode”  
  - prints “stage2: paging structures initialized”  
  - prints “stage2: entered long mode”  
  - halts deterministically.  
- all lint warnings and errors resolved.  

============================================================  
post completion chores  
============================================================  

1. rename the current phase file by adding a .complete to the end of the name. for example: phase_0008.txt would become phase_0008.txt.complete  
2. add all files and commit them to git using the following format for the comment.  
    - feat: phase 0008: long mode transition + 64‑bit entry  
3. determine the next phase sequentially and execute it: phase_0009.txt  