title: mozos — phase_0009: kernel loader (disk read into 0x00100000)  

intent  
introduce deterministic loading of the kernel image into high memory. this phase extends the stage‑2 loader to read kernel.img from disk (lba) into physical address 0x00100000. no execution of kernel yet. no mining logic.  

this phase adds:  
- bios lba disk read routine for multiple sectors  
- dap structure for kernel load  
- kernel.img placement at 0x00100000  
- confirmation banner after kernel load  

no kernel execution.  
no hashing.  

============================================================  
section 1 — workspace structure extension  
============================================================  

1. add kernel/kernel.c (placeholder) and kernel/link.ld (placeholder).  
2. update makefile to assemble kernel into kernel/kernel.img.  
3. modify boot/stage2.asm to read kernel.img from disk into 0x00100000.  

============================================================  
section 2 — implement kernel loader  
============================================================  

1. in boot/stage2.asm:  
   - define dap for kernel load: size=0x10, sectors=64 (adjust as needed), buffer=0x00100000, lba=8.  
   - call int 0x13, ah=0x42 with dap pointer.  
   - handle carry flag for error detection.  
   - after successful read, print banner (“stage2: kernel loaded at 0x00100000”).  

2. halt in place after printing.  

============================================================  
section 3 — deterministic boot behavior  
============================================================  

1. bios loads mbr at 0x7c00.  
2. mbr prints banner, reads stage‑2 from lba 2 into 0x8000.  
3. mbr jumps to 0x8000.  
4. stage‑2 enables a20, loads gdt, enters protected mode, builds paging structures, enters long mode, reads kernel.img into 0x00100000, prints confirmation banner, halts deterministically.  

============================================================  
section 4 — no other files modified  
============================================================  

- do not execute kernel yet.  
- only modify stage‑2 to load kernel.img.  

============================================================  
completion criteria  
============================================================  

- boot/stage2.asm assembles to boot/stage2.bin without errors.  
- boot/mbr.asm assembles to boot/mbr.bin without errors.  
- kernel/kernel.c and kernel/link.ld exist as placeholders and build into kernel/kernel.img.  
- boot image runs in qemu:  
  - prints “mbr: mozos boot entry”  
  - prints “stage2: a20 line enabled”  
  - prints “stage2: gdt loaded”  
  - prints “stage2: entered protected mode”  
  - prints “stage2: paging structures initialized”  
  - prints “stage2: entered long mode”  
  - prints “stage2: kernel loaded at 0x00100000”  
  - halts deterministically.  
- all lint warnings and errors resolved.  

============================================================  
post completion chores  
============================================================  

1. rename the current phase file by adding a .complete to the end of the name. for example: phase_0009.txt would become phase_0009.txt.complete  
2. add all files and commit them to git using the following format for the comment.  
    - feat: phase 0009: kernel loader (disk read into 0x00100000)  
3. determine the next phase sequentially and execute it: phase_0010.txt  